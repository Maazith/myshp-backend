# Render Deployment Guide - Complete Setup Instructions

## üéØ Overview

This guide provides complete instructions for deploying the Django backend to Render and ensuring it runs 100% error-free.

---

## üìã Prerequisites

- GitHub repository with backend code
- Render account (free tier works)
- PostgreSQL database (Render provides free tier)

---

## üöÄ Step-by-Step Deployment

### Step 1: Connect Repository to Render

1. **Go to Render Dashboard:**
   - Visit: https://dashboard.render.com
   - Click **"New +"** ‚Üí **"Blueprint"**

2. **Select Repository:**
   - Connect your GitHub account if not already connected
   - Select repository: `Maazith/myshp-backend`
   - Render will detect `render.yaml` automatically

3. **Review Configuration:**
   - Render will read `render.yaml` and configure:
     - Web service: `myshp-backend`
     - PostgreSQL database: `myshp-db`
     - Environment variables

---

### Step 2: Configure Environment Variables

Go to your service ‚Üí **Environment** tab and set these variables:

#### Required Variables:

| Variable | Value | Description |
|---------|-------|-------------|
| `DEBUG` | `False` | Disable debug mode in production |
| `SECRET_KEY` | *(auto-generated)* | Django secret key (auto-generated by Render) |
| `DATABASE_URL` | *(auto-set)* | PostgreSQL connection string (auto-set from database) |
| `RENDER` | `true` | Enable Render environment detection |
| `ENVIRONMENT` | `production` | Set production environment |

#### CORS and Frontend URLs:

| Variable | Value | Description |
|---------|-------|-------------|
| `VERCEL_FRONTEND_URL` | `https://myshp-frontend.vercel.app` | Your Vercel frontend URL |
| `CORS_ALLOWED_ORIGINS` | `https://edithcloths.com,https://www.edithcloths.com,https://myshp-frontend.vercel.app` | Allowed CORS origins |
| `CSRF_TRUSTED_ORIGINS` | `https://edithcloths.com,https://www.edithcloths.com,https://myshp-frontend.vercel.app` | CSRF trusted origins |

#### Admin User Creation:

| Variable | Value | Description |
|---------|-------|-------------|
| `DJANGO_SUPERUSER_USERNAME` | `admin` | Admin username (set your own) |
| `DJANGO_SUPERUSER_EMAIL` | `admin@example.com` | Admin email (set your own) |
| `DJANGO_SUPERUSER_PASSWORD` | `your-strong-password` | Admin password (set strong password) |

#### Email Configuration (Optional):

| Variable | Value | Description |
|---------|-------|-------------|
| `EMAIL_HOST_PASSWORD` | `your-app-password` | Gmail app password (if using Gmail) |
| `EMAIL_HOST_USER` | `your-email@gmail.com` | Email address for sending emails |

---

### Step 3: Verify Build Configuration

Render will automatically use:
- **Build Command:** `bash build.sh`
- **Start Command:** `bash start.sh`
- **Root Directory:** `backend/backend/backend` (if using nested structure)

**Important:** If your repository structure is different, update the root directory in Render dashboard.

---

### Step 4: Deploy

1. **Click "Apply"** or **"Create Web Service"**
2. **Wait for deployment** (10-15 minutes first time)
3. **Monitor build logs** for any errors

---

## ‚úÖ Post-Deployment Verification

### 1. Check Service Status

- Service should show **"Live"** status
- Health check should pass: `/api/products/`

### 2. Test Endpoints

Run the verification script:
```bash
python verify_deployment.py
```

Or test manually:

**API Root:**
```bash
curl https://myshp-backend.onrender.com/api/
```

**Products:**
```bash
curl https://myshp-backend.onrender.com/api/products/
```

**Admin Panel:**
```bash
curl https://myshp-backend.onrender.com/edith-admin-login/
```

### 3. Verify CORS

Test from browser console on your frontend:
```javascript
fetch('https://myshp-backend.onrender.com/api/products/')
  .then(r => r.json())
  .then(console.log)
  .catch(console.error);
```

Should return products without CORS errors.

---

## üîß Troubleshooting

### Issue: Build Fails

**Check:**
- Python version matches `runtime.txt` (3.11.9)
- All dependencies in `requirements.txt` are valid
- Build logs for specific error messages

**Fix:**
- Update `requirements.txt` if package versions are incompatible
- Check Python version compatibility

### Issue: Service Won't Start

**Check:**
- `start.sh` is executable
- `PORT` environment variable is set (Render sets this automatically)
- Database connection is working
- Migrations completed successfully

**Fix:**
- Check Render logs for specific errors
- Verify `DATABASE_URL` is set correctly
- Ensure `SECRET_KEY` is set

### Issue: Static Files Not Loading

**Check:**
- `build.sh` ran successfully
- `staticfiles` directory exists
- WhiteNoise is configured correctly

**Fix:**
- Rebuild service to re-run `collectstatic`
- Check `STATIC_ROOT` path in settings

### Issue: CORS Errors

**Check:**
- `CORS_ALLOWED_ORIGINS` includes your frontend URL
- Frontend is making requests to correct backend URL
- `CSRF_TRUSTED_ORIGINS` includes frontend URL

**Fix:**
- Add frontend URL to `CORS_ALLOWED_ORIGINS` environment variable
- Update `CSRF_TRUSTED_ORIGINS` environment variable
- Redeploy service

### Issue: Media Files Not Accessible

**Note:** Render's filesystem is temporary. Media files will be lost on redeploy.

**Solutions:**
1. **Temporary (Current):** Media files served locally, but lost on redeploy
2. **Recommended:** Integrate cloud storage (S3, Cloudinary, etc.)

---

## üìä Environment Variables Summary

### Automatically Set by Render:
- `PORT` - Server port (usually 10000)
- `DATABASE_URL` - PostgreSQL connection string
- `RENDER` - Set to "true" when on Render
- `RENDER_SERVICE_NAME` - Your service name

### Must Set Manually:
- `DEBUG` = `False`
- `SECRET_KEY` = *(auto-generated or set manually)*
- `DJANGO_SUPERUSER_USERNAME` = Your admin username
- `DJANGO_SUPERUSER_EMAIL` = Your admin email
- `DJANGO_SUPERUSER_PASSWORD` = Your admin password
- `VERCEL_FRONTEND_URL` = Your Vercel frontend URL
- `CORS_ALLOWED_ORIGINS` = Comma-separated list of allowed origins
- `CSRF_TRUSTED_ORIGINS` = Comma-separated list of trusted origins

---

## üîê Security Checklist

- [ ] `DEBUG` is set to `False`
- [ ] `SECRET_KEY` is strong and unique
- [ ] `ALLOWED_HOSTS` includes your Render URL
- [ ] `CORS_ALLOWED_ORIGINS` only includes trusted domains
- [ ] `CSRF_TRUSTED_ORIGINS` only includes trusted domains
- [ ] Admin password is strong
- [ ] Database credentials are secure (auto-managed by Render)

---

## üìù Files Modified for Render Deployment

1. **`settings.py`**
   - Auto-detects Render environment
   - Configures ALLOWED_HOSTS dynamically
   - Sets up CORS for Vercel frontend
   - Configures static/media files
   - Disables DEBUG in production

2. **`render.yaml`**
   - Defines web service configuration
   - Sets environment variables
   - Configures PostgreSQL database
   - Sets health check path

3. **`build.sh`**
   - Installs dependencies
   - Collects static files
   - Verifies build success

4. **`start.sh`**
   - Runs migrations
   - Creates admin user
   - Starts Gunicorn server

5. **`requirements.txt`**
   - All dependencies with compatible versions
   - Includes production server (Gunicorn)
   - Includes static file serving (WhiteNoise)

6. **`runtime.txt`**
   - Specifies Python version (3.11.9)

---

## üéØ Quick Reference

### Service URL:
```
https://myshp-backend.onrender.com
```

### API Endpoints:
- Root: `https://myshp-backend.onrender.com/api/`
- Products: `https://myshp-backend.onrender.com/api/products/`
- Admin: `https://myshp-backend.onrender.com/edith-admin-login/`

### Health Check:
```
https://myshp-backend.onrender.com/api/products/
```

---

## ‚úÖ Deployment Checklist

- [ ] Repository connected to Render
- [ ] `render.yaml` detected and configured
- [ ] All environment variables set
- [ ] Database created and connected
- [ ] Service deployed successfully
- [ ] Health check passes
- [ ] API endpoints accessible
- [ ] CORS configured correctly
- [ ] Admin user created
- [ ] Static files loading
- [ ] Frontend can connect to backend

---

## üÜò Support

If deployment fails:

1. **Check Render Logs:**
   - Go to service ‚Üí **Logs** tab
   - Look for error messages
   - Check build logs and runtime logs separately

2. **Run Verification Script:**
   ```bash
   python verify_deployment.py
   ```

3. **Test Locally:**
   - Set environment variables locally
   - Run `bash build.sh` and `bash start.sh`
   - Test endpoints

4. **Common Issues:**
   - Missing environment variables
   - Database connection issues
   - Static files not collected
   - CORS misconfiguration

---

**Status:** ‚úÖ Ready for Deployment
**Last Updated:** After comprehensive Render deployment fixes

